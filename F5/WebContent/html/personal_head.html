<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>个人中心</title>

		<link rel="stylesheet" href="../js/bootstrap/css/bootstrap.css" />
		<link rel="stylesheet" href="../js/head/js/cropper.min.css" />
		<link rel="stylesheet" href="../js/head/js/sitelogo.css" />
		<link rel="stylesheet" href="../js/head/css/font-awesome.min.css" />

		<script type="text/javascript" src="../js/head/js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/global.js"></script>
		<script type="text/javascript" src="../js/head/js/cropper.js"></script>
		<script type="text/javascript" src="../js/head/js/sitelogo.js"></script>
		<script type="text/javascript" src="../js/head/js/html2canvas.min.js"></script>
		<script type="text/javascript" src="../js/bootstrap/js/bootstrap.js"></script>
		<script type="text/javascript" src="../js/layer/layer.js"></script>
		<script type="text/javascript" src="../js/vue.js"></script>
		<script type="text/javascript" src="../js/URL.js"></script>
		<style type="text/css">
			body {
				background-color: #545353;
				background-size: cover;
			}
			
			#head {
				width: auto;
				height: 50px;
				//background: rgba(0, 0, 0, 0.5);
				margin: auto;
				background-image: url(../images/bg7.jpg);
				//background-color: 	#545353;
				//	position: relative;
			}
			
			.carousel {
				width: 1000px;
				height: 400px;
				margin: auto;
			}
			/*img {
				width: 1200px;
				height: 400px!important;
				margin: auto;
			}*/
			
			.carousel-inner {
				height: 400px;
				overflow: hidden;
			}
			
			#caidan1 {
				width: 1000px;
				text-align: center;
				color: #F6F6F6;
				margin: auto;
			}
			
			#caidan2 {
				width: 1000px;
				text-align: center;
			}
			
			#zhongxin {
				background-color: #FFFFFF;
				width: 1000px;
				height: 650px;
				margin: auto;
			}
			
			#xiala {
				width: 300px;
			}
			
			.panel-group {
				max-height: 770px;
				overflow: auto;
			}
			
			.leftMenu {
				margin: 10px;
				margin-top: 5px;
			}
			
			.leftMenu .panel-heading {
				font-size: 14px;
				padding-left: 20px;
				height: 36px;
				line-height: 36px;
				color: white;
				position: relative;
				cursor: pointer;
			}
			/*转成手形图标*/
			
			.leftMenu .panel-heading span {
				position: absolute;
				right: 10px;
				top: 12px;
			}
			
			.leftMenu .menu-item-left {
				padding: 2px;
				background: transparent;
				border: 1px solid transparent;
				border-radius: 6px;
			}
			
			.leftMenu .menu-item-left:hover {
				background: #C4E3F3;
				border: 1px solid #1E90FF;
			}
			
			#picture {
				text-align: center;
				width: 100px;
				height: 100px;
				background: url(../images/bg3.jpg) no-repeat;
				background-size: cover;
				margin: 50px auto;
				border-radius: 50%;
			}
			
			#account {
				width: 25%;
				margin: 80px auto;
			}
			
			#account .input {
				height: 45px;
				line-height: 45px;
				outline: none;
				width: calc(100% - 10px);
				background: rgba(0, 0, 0, 0.5);
				color: #00CCCC;
			}
		</style>
	</head>

	<body>
		<div id="app">

			<!--用户名显示开始-->
			<nav id="head" class="navbar navbar-inverse navbar-fixed-top">
				<div class="container">

					<!--logoa标志-->
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#myCollapse1">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
						<a href="./cloud_oa/pages/index.jsp" class="navbar-brand">
							<img src="../images/logo1.png" height="20" />
						</a>
					</div>
					<!--LOGO标志-->

					<!--当前登录用户-->
					<form if="userform" action="">
						<div class="collapse navbar-collapse navbar-right" id="myCollapse1">
							<ul class="nav navbar-nav nav-right">
								<li class="dropdown">
									<a href="#" data-toggle="dropdown" style="color: #FFFFFF;">
							<!--当前用户：<input type="text" :placeholder="emp.empLoginName" />
							<span class="caret"></span>-->
						</a>
									<ul class="dropdown-menu ">
										<li>
											<a href="login.html" id="modalBtn">切换用户</a>
										</li>
									</ul>
								</li>

							</ul>

						</div>

					</form>
					<!--当前登录用户-->

				</div>
				<!--/.container-fluid-->
			</nav>
			<!--用户名显示结束-->

			<!--轮播图-->
			<div id="carousel-example-generic" class="carousel slide center-block" data-ride="carousel">

				<!--轮播图格格数-->
				<ol class="carousel-indicators">
					<li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
					<li data-target="#carousel-example-generic" data-slide-to="1"></li>
				</ol>
				<!--轮播图格式-->

				<!--轮播图图片-->
				<div class="carousel-inner" role="listbox">
					<div class="item active">
						<img src="../images/19.jpg">
						<!--<div class="carousel-caption">
						图1
					</div>-->
					</div>
					<div class="item">
						<img src="../images/22.jpg">
						<!--<div class="carousel-caption">
						图2
					</div>-->
					</div>

				</div>
				<!--轮播图图片-->

				<!-- 轮播图左右移键 -->
				<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
					<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</a>
				<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
					<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</a>
				<!-- 轮播图左右移键 -->
			</div>
			<!--轮播图-->

			<!--菜单栏-->
			<nav class="navbar navbar-default" role="navigation" id="caidan1" style="text-align: center;">

				<div class="container-fluid" id="caidan2">
					<!--菜单栏头-->
					<div class="navbar-header" style="width: 70px;">
						<a class="navbar-brand active" href="../index.html" style="text-align: center; margin: auto;">主页</a>
					</div>
					<!--菜单栏头-->

					<div>
					<ul class="nav navbar-nav">
						<li style="width: 120px;"><a href="personal_a.html">个人中心</a></li>

						<li style="width: 120px;"><a href="room_query.html">会议室</a></li>
						<li style="width: 120px;"><a href="Work.html">工作安排</a></li>
						<li style="width: 120px;"><a href="things.html">资产管理</a></li>
						<li style="width: 120px;"><a href="expatriate.html">外派信息</a></li>
						<li style="width: 120px;"><a href="carpage.html">车辆管理</a></li>
						<li style="width: 120px;"><a href="BusinessCard.html">名片夹</a></li>

					</ul>
				</div>

				</div>
			</nav>
			<!--菜单栏-->

			<!--个人中心栏开始-->
			<div id="zhongxin">

				<div class="row">

					<!--左侧下拉菜单部分-->
					<div class="col-md-2">
						<div class="panel-group table-responsive" role="tablist">
							<!--分组一-->
							<div class="panel panel-primary leftMenu">
								<!-- 利用data-target指定要折叠的分组列表 -->
								<div class="panel-heading" id="collapseListGroupHeading1" data-toggle="collapse" data-target="#collapseListGroup1" role="tab">
									<h4 class="panel-title">
                                           主页信息
                <span class="glyphicon glyphicon-chevron-up right"></span>
              </h4>
								</div>
								<!-- .panel-collapse和.collapse标明折叠元素 .in表示要显示出来 -->
								<div id="collapseListGroup1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="collapseListGroupHeading1">
									<ul class="list-group">
										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="personal_a.html">查看个人信息</a>
                </button>
										</li>
										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="personal_update.html">修改个人信息</a>
                </button>
										</li>
										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="personal_pwd.html">修改密码</a>
                </button>
										</li>

										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="personal_head.html">上传头像</a>
                </button>
										</li>

										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="personal_queryother.html">查询他人信息</a>
                </button>
										</li>
										
										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="jia_add.html">请假申请</a>
                </button>
										</li>
										<li class="list-group-item">
											<button class="menu-item-left">
                  <span class="glyphicon glyphicon-triangle-right"></span><a href="jia_queryByName.html">我的请假记录</a>
                </button>
										</li>

									</ul>
								</div>
							</div>
							<!--分组一-->

						</div>
					</div>
					<!--左侧下拉菜单部分-->

					<!--右侧修改密码-->
					<div class="col-md-10">
						<div class="container">
							<h2 class="page-header">头像上传</h2>
							
							

							<img src="../images/default.jpg" id="headImg" class="img-responsive img-circle" style="margin-top: 20px; text-align: center;margin: 20px auto;" />
								
								<div style="text-align: center;margin: 50px auto;">
								<input type="button" value="更换头像" class="btn btn-primary" data-toggle="modal" data-target="#avatar-modal" />

							<input id="uploadBtn" type="button" value="上传新头像" class="btn btn-success" />
								
							</div>

							
						</div>

						<!--裁剪头像模特层开始-->
						<div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<!--<form class="avatar-form" action="upload-logo.php" enctype="multipart/form-data" method="post">-->
									<form class="avatar-form">
										<div class="modal-header">
											<button class="close" data-dismiss="modal" type="button">&times;</button>
											<h4 class="modal-title" id="avatar-modal-label">上传图片</h4>
										</div>
										<div class="modal-body">
											<div class="avatar-body">
												<div class="avatar-upload">
													<input class="avatar-src" name="avatar_src" type="hidden">
													<input class="avatar-data" name="avatar_data" type="hidden">
													<label for="avatarInput" style="line-height: 35px;">图片上传</label>
													<button class="btn btn-danger" type="button" style="height: 35px;" onClick="$('input[id=avatarInput]').click();">请选择图片</button>
													<span id="avatar-name"></span>
													<input class="avatar-input hide" id="avatarInput" name="avatar_file" type="file"></div>
												<div class="row">
													<div class="col-md-9">
														<div class="avatar-wrapper"></div>
													</div>
													<div class="col-md-3">
														<div class="avatar-preview preview-lg" id="imageHead"></div>
														<!--<div class="avatar-preview preview-md"></div>
								<div class="avatar-preview preview-sm"></div>-->
													</div>
												</div>
												<div class="row avatar-btns">
													<div class="col-md-4">
														<div class="btn-group">
															<button class="btn btn-danger fa fa-undo" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees"> 向左旋转</button>
														</div>
														<div class="btn-group">
															<button class="btn  btn-danger fa fa-repeat" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees"> 向右旋转</button>
														</div>
													</div>
													<div class="col-md-5" style="text-align: right;">
														<button class="btn btn-danger fa fa-arrows" data-method="setDragMode" data-option="move" type="button" title="移动">
										<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;setDragMode&quot;, &quot;move&quot;)">
										</span>
									  </button>
														<button type="button" class="btn btn-danger fa fa-search-plus" data-method="zoom" data-option="0.1" title="放大图片">
										<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, 0.1)">
										  <!--<span class="fa fa-search-plus"></span>-->
										</span>
									  </button>
														<button type="button" class="btn btn-danger fa fa-search-minus" data-method="zoom" data-option="-0.1" title="缩小图片">
										<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;zoom&quot;, -0.1)">
										  <!--<span class="fa fa-search-minus"></span>-->
										</span>
									  </button>
														<button type="button" class="btn btn-danger fa fa-refresh" data-method="reset" title="重置图片">
											<span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="$().cropper(&quot;reset&quot;)" aria-describedby="tooltip866214">
											</span>
									   </button>
													</div>
													<div class="col-md-3">
														<button class="btn btn-danger btn-block avatar-save fa fa-save" type="button" data-dismiss="modal"> 保存修改</button>
													</div>
												</div>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
						<!--裁剪头像模特层结束-->

						<div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>

					</div>
					<!--右侧修改密码-->

				</div>

				<!--切换折叠指示图标-->

				<!--切换折叠指示图标-->

			</div>
			<!--个人中心栏结束-->

		</div>

		<!--尾部介绍开始-->
		<footer>
			<div class="container-fluid footer_style">
				<div class="col-md-6 col-md-offset-3 text-center">
					<h4><img src="../images/logo1.png" height="20"/></h4>
					<p>地址：金石滩</p>
					<p>DLNU</p>
				</div>
			</div>
		</footer>
		<!--尾部介绍结束-->

		<script>
		
			/*表单验证*/
			var vue = new Vue({
				el: '#app',
				data: {
					emp: ''
				},

				methods: {

					//查询数据
					query: function() {

						//调用后端功能
						$.getJSON(baseUrl + '/emp/queryByName', function(data) {

							vue.emp = data;

						});
					},
				},
				mounted: function() { //网页渲染完毕调用
					this.query(); //这是 vue 的方法 所以可以用 this，这个时候 vue 还没初始化，所以用 vue 不行
				}

			});
		
			/*折叠菜单*/
			$(function() {
				$(".panel-heading").click(function(e) {
					/**/
					$(this).find("span").toggleClass("glyphicon-chevron-down");
					$(this).find("span").toggleClass("glyphicon-chevron-up");
				});
			});
			/*折叠菜单*/

			//头像base64数据
			var base64;

			//做个下简易的验证  大小 格式 
			$('#avatarInput').on('change', function(e) {
								
				var filemaxsize = 1024 * 5; //5M
				var target = $(e.target);
				var Size = target[0].files[0].size / 1024;
				if (Size > filemaxsize) {
					alert('图片过大，请重新选择!');
					$(".avatar-wrapper").childre().remove;
					return false;
				}
				if (!this.files[0].type.match(/image.*/)) {
					alert('请选择正确的图片!')
				} else {
					var filename = document.querySelector("#avatar-name");
					var texts = document.querySelector("#avatarInput").value;
					var teststr = texts; //你这里的路径写错了
					testend = teststr.match(/[^\\]+\.[^\(]+/i); //直接完整文件名的
					filename.innerHTML = testend;
				}
			});

			//单击保存修改按钮
			$(".avatar-save").on("click", function() {
				
				var img_lg = document.getElementById('imageHead');
				// 截图小的显示框内的内容
				html2canvas(img_lg, {
					allowTaint: true,
					taintTest: false,
					onrendered: function(canvas) {
						canvas.id = "mycanvas";
						//生成base64图片数据
						var dataUrl = canvas.toDataURL("image/jpeg");
						var newImg = document.createElement("img");
						newImg.src = dataUrl;
						alert(dataUrl);
						//显示预览图
						$('#headImg').attr('src', dataUrl);
						//保持base64数据
						base64 = dataUrl;
					}
				});
			});

			//上传新头像
			$('#uploadBtn').click(function() {

				
				$.post(baseUrl + '/emp/updatePic', {
					empPic: base64
				}, function(data) {

					layer.msg('修改头像成功');
					
					location.href = 'personal_a.html';

				});

			});

			//如果用户有头像数据，显示用户头像
			$.get(baseUrl + '/emp/queryHead', function(data) {

				if (data == null || data == '')
					return;

				$('#headImg').attr('src', data);
			});

			
		</script>

	</body>

</html>